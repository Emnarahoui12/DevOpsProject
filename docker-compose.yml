
version: "2"

services:

  mysqldb:

    image: mysql:5.7

    restart: unless-stopped

    environment:

      - MYSQL_DATABASE=achatdb

      - MYSQL_ALLOW_EMPTY_PASSWORD=1
    ports:

      - "3306:3306"

    volumes:

      - db:/var/lib/mysql

  app:

    container_name: spring

    image: medrahmouni/devops
    depends_on:

    - mysqldb

    build: .

    restart: on-failure

    ports:

    - "8089:8089"

    environment:

     SPRING_APPLICATION_JSON: '{

       "spring.datasource.url"  : "jdbc:mysql://localhost:3306/achatdb?useUnicode=true&useJDBCCompliantTimezoneShift=true&useLegacyDatetimeCode=false&serverTimezone=UTC",

       "spring.datasource.username" : "root",

       "spring.datasource.password" : "",

       "spring.jpa.properties.hibernate.dialect" : "org.hibernate.dialect.MySQL5InnoDBDialect",

       "spring.jpa.hibernate.ddl-auto" : "update"}'

    stdin_open: true

    tty: true



  sonarqube:
    image: sonarqube:8.9.7-community
    ports:
      - "9000:9000"
      - "9092:9092"
    volumes:
      - "SonarQube_data:/opt/SonarQube/data"
      - "SonarQube_extensions:/opt/SonarQube/extensions"
      - "SonarQube_logs:/opt/SonarQube/logs"
  nexus:
    image: sonatype/nexus3
    ports:
      - "8081:8081"
    volumes:
      - "nexus-data:/nexus-data"






volumes:
  SonarQube_data:
  SonarQube_extensions:
  SonarQube_logs:
  nexus-data:
  db:


